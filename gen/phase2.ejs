#!/bin/bash
set -ev
shopt -s dotglob

export HOME=/home/runner

ln -s /usr/lib/chromium-browser/chromedriver /usr/local/bin

<% for ( let lang of languages ) { -%>
<% if ( lang.setup ) { -%>


echo Setup <%= lang.name %>
<% for ( let line of lang.setup ) { -%>
<%- undup(line) %>
<% } -%>

if [ -n "$(ls -A /home/runner)" ]; then
	echo Erasing home for <%= lang.name %>
	rm -rf /home/runner/*
fi
<% } -%>
<% } -%>

chown runner:runner -R /opt/homes
cp -r /opt/homes/default/* /home/runner
chown runner:runner -R /home/runner
chown runner:runner -R /config

rm -rf /var/lib/apt/lists/*
rm /phase2.sh
